

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2. Basic Components of METplus Python Wrappers &mdash; METplus 3.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. How to Create Your Own Wrapper" href="create_wrapper.html" />
    <link rel="prev" title="1. Coding Standards" href="coding_standards.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> METplus
          

          
            
            <img src="../_static/METplus_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">METplus Wrappers Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Users_Guide/index.html">User’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Contributor’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="coding_standards.html">1. Coding Standards</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2. Basic Components of METplus Python Wrappers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#commandbuilder">2.1. CommandBuilder</a></li>
<li class="toctree-l3"><a class="reference internal" href="#isok-class-variable">2.2. isOK class variable</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-at-time-function">2.3. run_at_time function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-all-times-function">2.4. run_all_times function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-command-function">2.5. get_command function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set-environment-variables-function">2.6. set_environment_variables function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#find-data-find-model-find-obs-functions-in-commandbuilder">2.7. find_data/find_model/find_obs functions (in CommandBuilder)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stringsub-class">2.8. StringSub class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-utilities">2.9. Time Utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="#main-function">2.10. main function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="create_wrapper.html">3. How to Create Your Own Wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="conda_env.html">4. Instructions for the Conda Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="deprecation.html">5. Deprecating an Old Config Variable</a></li>
<li class="toctree-l2"><a class="reference internal" href="github_workflow.html">6. GitHub Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">7. Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="add_use_case.html">8. Adding Use Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html">9. Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">METplus</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Contributor’s Guide</a> &raquo;</li>
        
      <li><span class="section-number">2. </span>Basic Components of METplus Python Wrappers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Contributors_Guide/basic_components.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="basic-components-of-metplus-python-wrappers">
<h1><span class="section-number">2. </span>Basic Components of METplus Python Wrappers<a class="headerlink" href="#basic-components-of-metplus-python-wrappers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="commandbuilder">
<h2><span class="section-number">2.1. </span>CommandBuilder<a class="headerlink" href="#commandbuilder" title="Permalink to this headline">¶</a></h2>
<p>CommandBuilder is the parent class of all METplus wrappers. Every wrapper is a subclass of CommandBuilder or another subclass of CommandBuilder. For example, GridStatWrapper, PointStatWrapper, EnsembleStatWrapper, and MODEWrapper are all a subclass of CompareGriddedWrapper. CompareGriddedWrapper is a subclass of CommandBuilder. CommandBuilder contains instance variables that are common to every wrapper, such as config (METplusConfig object), errors (a counter of the number of errors that have occurred in the wrapper), and c_dict (a dictionary containing common information). CommandBuilder also contains use class functions that can be called within each wrapper, such as create_c_dict, clear, and find_data. More information regarding these variables and functions can be found in the Doxygen documentation (link?).</p>
<p>Each wrapper contains an initialization function (__init__) that sets up the wrapper. Every wrapper’s initialization function should at very least call the parent’s initialization function (using super() function). Many wrapper also set the app_name and app_path instance variables in the initialization function. app_name is the name of the MET executable that pertains to the wrapper and app_path is the full path of the MET executable (relative to MET_INSTALL_DIR/bin) that is called when the MET tool is run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExampleWrapper</span><span class="p">(</span><span class="n">CommandBuilder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;!Wrapper can be used as a base to develop a new wrapper&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_name</span> <span class="o">=</span> <span class="s1">&#39;example&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getdir</span><span class="p">(</span><span class="s1">&#39;MET_INSTALL_DIR&#39;</span><span class="p">),</span>
                                                        <span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_name</span><span class="p">)</span>
</pre></div>
</div>
<p>The above code block is an excerpt from the ExampleWrapper, found in ush/example_wrapper.py. The class name should always be the item that is passed into the METplus configuration variable list PROCESS_LIST with ‘Wrapper’ at the end. The text ‘CommandBuilder’ in parenthesis makes ExampleWrapper a subclass of CommandBuilder. In the __init__ function, the line starting with ‘super()’ calls the parent class __init__ function.</p>
<p>CommandBuilder’s initialization function sets default values for instance variables, initializes the CommandRunner object (used to execute shell commands), and calls the create_c_dict() function. This function is found in CommandBuilder but it is also implemented by most (eventually all) wrappers. The wrapper implementations start off by calling the parent’s version of create_c_dict using super(), then adding additional dictionary items that are specific to that wrapper and finally returning the dictionary that was created. If possible, all of the calls to the ‘get’ functions of the cMETplusConfig object should be found in the create_c_dict function. This allows the configuration values to be referenced throughout the wrapper without the redundantly referencing the wrapper name (i.e. ASCII2NC_INPUT_DIR can be referenced as INPUT_DIR in ASCII2NC since we already it pertains to ASCII2NC) It also makes it easier to see which configuration variables are used in each wrapper.</p>
<p>create_c_dict (ExampleWrapper):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_c_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">c_dict</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">create_c_dict</span><span class="p">()</span>
    <span class="c1"># get values from config object and set them to be accessed by wrapper</span>
    <span class="n">c_dict</span><span class="p">[</span><span class="s1">&#39;INPUT_TEMPLATE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getraw</span><span class="p">(</span><span class="s1">&#39;filename_templates&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;EXAMPLE_INPUT_TEMPLATE&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">c_dict</span><span class="p">[</span><span class="s1">&#39;INPUT_DIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getdir</span><span class="p">(</span><span class="s1">&#39;EXAMPLE_INPUT_DIR&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">c_dict</span><span class="p">[</span><span class="s1">&#39;INPUT_TEMPLATE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[filename_templates] EXAMPLE_INPUT_TEMPLATE was not set. &#39;</span>
                         <span class="s1">&#39;You should set this variable to see how the runtime is &#39;</span>
                         <span class="s1">&#39;substituted. For example: {valid?fmt=%Y%m</span><span class="si">%d</span><span class="s1">%H}.ext&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">c_dict</span><span class="p">[</span><span class="s1">&#39;INPUT_DIR&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;EXAMPLE_INPUT_DIR was not set&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">c_dict</span>
</pre></div>
</div>
<p>create_c_dict (CommandBuilder):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_c_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">c_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="c1"># set skip if output exists to False for all wrappers</span>
    <span class="c1"># wrappers that support this functionality can override this value</span>
    <span class="n">c_dict</span><span class="p">[</span><span class="s1">&#39;VERBOSITY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getstr</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;LOG_MET_VERBOSITY&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span>
    <span class="n">c_dict</span><span class="p">[</span><span class="s1">&#39;SKIP_IF_OUTPUT_EXISTS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">c_dict</span><span class="p">[</span><span class="s1">&#39;FCST_INPUT_DATATYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">c_dict</span><span class="p">[</span><span class="s1">&#39;OBS_INPUT_DATATYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">c_dict</span><span class="p">[</span><span class="s1">&#39;ALLOW_MULTIPLE_FILES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">c_dict</span><span class="p">[</span><span class="s1">&#39;CURRENT_VAR_INFO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">c_dict</span>
</pre></div>
</div>
</div>
<div class="section" id="isok-class-variable">
<h2><span class="section-number">2.2. </span>isOK class variable<a class="headerlink" href="#isok-class-variable" title="Permalink to this headline">¶</a></h2>
<p>isOK is defined in CommandBuilder (ush/command_builder.py).</p>
<p>Its function is to note a failed process while not stopping a parent process.
Instead of instantly exiting a larger wrapper script once one sub process has failed we
want all of the processes to attempt to be executed and then note which ones failed.</p>
<p>At the end of the wrapper initialization step, all isOK=false will be collected and reported. Execution of the wrappers will not occur unless all wrappers in the process list are initialized correctly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c_dict</span><span class="p">[</span><span class="s1">&#39;CONFIG_FILE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getstr</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;MODE_CONFIG_FILE&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">c_dict</span><span class="p">[</span><span class="s1">&#39;CONFIG_FILE&#39;</span><span class="p">]:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s1">&#39;MODE_CONFIG_FILE must be set&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">isOK</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>See MODEWrapper (ush/mode_wrapper.py) for other examples.</p>
</div>
<div class="section" id="run-at-time-function">
<h2><span class="section-number">2.3. </span>run_at_time function<a class="headerlink" href="#run-at-time-function" title="Permalink to this headline">¶</a></h2>
<p>run_at_time runs a process for one specific time.
This is defined in CommandBuilder.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_at_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;! Loop over each forecast lead and build pb2nc command &quot;&quot;&quot;</span>
     <span class="c1"># loop of forecast leads and process each</span>
    <span class="n">lead_seq</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_lead_sequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">lead</span> <span class="ow">in</span> <span class="n">lead_seq</span><span class="p">:</span>
        <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;lead&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lead</span>

        <span class="n">lead_string</span> <span class="o">=</span> <span class="n">time_util</span><span class="o">.</span><span class="n">ti_calculate</span><span class="p">(</span><span class="n">input_dict</span><span class="p">)[</span><span class="s1">&#39;lead_string&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing forecast lead </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lead_string</span><span class="p">))</span>

        <span class="c1"># Run for given init/valid time and forecast lead combination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_at_time_once</span><span class="p">(</span><span class="n">input_dict</span><span class="p">)</span>
</pre></div>
</div>
<p>See ush/pb2nc_wrapper.py for an example.</p>
</div>
<div class="section" id="run-all-times-function">
<h2><span class="section-number">2.4. </span>run_all_times function<a class="headerlink" href="#run-all-times-function" title="Permalink to this headline">¶</a></h2>
<p>run_all_times loops over a series of times calling run_at_time for one process for each time
Defined in CommandBuilder but overridden in a wrappers that process all of the data from every run time at once.</p>
<p>See SeriesByLeadWrapper (ush/series_by_lead_wrapper.py) for an example of overridding the function</p>
</div>
<div class="section" id="get-command-function">
<h2><span class="section-number">2.5. </span>get_command function<a class="headerlink" href="#get-command-function" title="Permalink to this headline">¶</a></h2>
<p>get_command assembles a MET command with arguments that can be run via the shell or the wrapper.
It is defined in CommandBuilder but is overridden in most wrappers because the command line arguments differ for each MET tool.</p>
</div>
<div class="section" id="set-environment-variables-function">
<h2><span class="section-number">2.6. </span>set_environment_variables function<a class="headerlink" href="#set-environment-variables-function" title="Permalink to this headline">¶</a></h2>
<p>Uses add_env_var function (CommandBuilder) to set any shell environment variables that MET or other METplus wrappers
need to be set. This allows a wrapper to pass information into a MET configuration file. The MET config file refers to the environment variables.
This is currently only set in wrappers that use MET config files, but the other wrappers will also need to set environment variables
that are needed to be set in the environment when running, such as MET_TMP_DIR and MET_PYTHON_EXE.</p>
</div>
<div class="section" id="find-data-find-model-find-obs-functions-in-commandbuilder">
<h2><span class="section-number">2.7. </span>find_data/find_model/find_obs functions (in CommandBuilder)<a class="headerlink" href="#find-data-find-model-find-obs-functions-in-commandbuilder" title="Permalink to this headline">¶</a></h2>
<p>find_* uses the c_dict directory templates and then queries the file system to find the files you are looking for
uses c_dict dictionary items [FCST/OBS]_FILE_WINDOW_[BEGIN/END], [FCST/OBS]_INPUT_[DIR/TEMPLATE], etc.
If [FCST/OBS]_FILE_WINDOW_[BEGIN/END] are non-zero, these functions will list all files under [FCST/OBS]_INPUT_DIR and use [FCST/OBS]_INPUT_TEMPLATE to extract out time information from each file to determine which files within the file window range should be used. Some tools allow multiple files to be selected. If a tool does not allow multiple files, the file closest to the valid time is returned. If multiple files are the same distance from the valid time, the first file that was found is used.
If a wrapper can read in multiple files, the c_dict item ‘ALLOW_MULTIPLE_FILES’ should be set to True.</p>
</div>
<div class="section" id="stringsub-class">
<h2><span class="section-number">2.8. </span>StringSub class<a class="headerlink" href="#stringsub-class" title="Permalink to this headline">¶</a></h2>
<p>StringSub is found in ush/string_template_substitution.py and is the critical function for substituting the placeholder
values in templates with the actual values needed for running a particular wrapper</p>
<p>tc_pairs_wrapper has a good example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># get search expression for bdeck files to pass to glob</span>
    <span class="n">string_sub</span> <span class="o">=</span> <span class="n">StringSub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">c_dict</span><span class="p">[</span><span class="s1">&#39;BDECK_TEMPLATE&#39;</span><span class="p">],</span>
                           <span class="n">basin</span><span class="o">=</span><span class="n">basin</span><span class="p">,</span>
                           <span class="n">cyclone</span><span class="o">=</span><span class="n">cyclone</span><span class="p">,</span>
                           <span class="o">**</span><span class="n">time_info</span><span class="p">)</span>
    <span class="n">bdeck_glob</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c_dict</span><span class="p">[</span><span class="s1">&#39;BDECK_DIR&#39;</span><span class="p">],</span>
                              <span class="n">string_sub</span><span class="o">.</span><span class="n">do_string_sub</span><span class="p">())</span>
</pre></div>
</div>
<p>time_info is a dictionary of current run time information that can be substituted into the template. See the ‘Time Utilities’ section for more information.</p>
</div>
<div class="section" id="time-utilities">
<h2><span class="section-number">2.9. </span>Time Utilities<a class="headerlink" href="#time-utilities" title="Permalink to this headline">¶</a></h2>
<p>time_util is a collection of functions to handle the idosyncracies of working with valid, initialization and observation times.
METplus creates a dictionary containing the current time and either init or valid time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">input_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;now&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clock_time_obj</span>

<span class="k">if</span> <span class="n">use_init</span><span class="p">:</span>
    <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loop_time</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;valid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loop_time</span>
</pre></div>
</div>
<p>The forecast lead is also set if provided (‘lead’). This dictionary is passed into time_util’s ti_calculate function, which determines the other time values that were not provided:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">time_util</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;init&#39;</span><span class="p">:</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;1987020106&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">),</span> <span class="s1">&#39;lead&#39;</span><span class="p">:</span><span class="mi">10800</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time_util</span><span class="o">.</span><span class="n">ti_calculate</span><span class="p">(</span><span class="n">input_dict</span><span class="p">)</span>
<span class="go">{&#39;lead&#39;: 10800, &#39;offset&#39;: 0, &#39;init&#39;: datetime.datetime(1987, 2, 1, 6, 0), &#39;valid&#39;: datetime.datetime(1987, 2, 1, 9, 0), &#39;loop_by&#39;: &#39;init&#39;, &#39;da_init&#39;: datetime.datetime(1987, 2, 1, 9, 0), &#39;init_fmt&#39;: &#39;19870201060000&#39;, &#39;da_init_fmt&#39;: &#39;19870201090000&#39;, &#39;valid_fmt&#39;: &#39;19870201090000&#39;, &#39;lead_string&#39;: &#39;3 hours&#39;, &#39;lead_hours&#39;: 3, &#39;lead_minutes&#39;: 180, &#39;lead_seconds&#39;: 10800, &#39;offset_hours&#39;: 0, &#39;date&#39;: datetime.datetime(1987, 2, 1, 9, 0), &#39;cycle&#39;: datetime.datetime(1987, 2, 1, 9, 0)}</span>
</pre></div>
</div>
<p>Items that will be parsed from the input dictionary are: now, init, valid, lead, lead_seconds, lead_minutes, lead_hours, offset, offset_hours, da_init</p>
<p>pcp_combine uses a variety of time_util functions like ti_calculate and ti_get_lead_string</p>
</div>
<div class="section" id="main-function">
<h2><span class="section-number">2.10. </span>main function<a class="headerlink" href="#main-function" title="Permalink to this headline">¶</a></h2>
<p>Each wrapper should call met_util’s run_stand_alone so that the wrapper will run if called directly instead of calling master_metplus.py:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">met_util</span> <span class="k">as</span> <span class="nn">util</span>
<span class="o">...</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">util</span><span class="o">.</span><span class="n">run_stand_alone</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="s2">&quot;Example&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="create_wrapper.html" class="btn btn-neutral float-right" title="3. How to Create Your Own Wrapper" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="coding_standards.html" class="btn btn-neutral float-left" title="1. Coding Standards" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, NCAR

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>